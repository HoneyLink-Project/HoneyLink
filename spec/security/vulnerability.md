# docs/security/vulnerability.md

**バッジ:** `🚫 実装コード非出力` `🚫 C/C++依存禁止`

> HoneyLink™ の脅威モデルと脆弱性対策を仕様化します。STRIDE フレームワークを採用し、実装コードや C/C++ 依存テクノロジーは含めません。

## 目次
- [docs/security/vulnerability.md](#docssecurityvulnerabilitymd)
  - [目次](#目次)
  - [脅威モデリング方針](#脅威モデリング方針)
  - [STRIDE マトリクス](#stride-マトリクス)
  - [入力検証と出力エスケープ](#入力検証と出力エスケープ)
  - [CSRF/XSS/SQLi 対策](#csrfxsssqli-対策)
  - [サプライチェーンリスク](#サプライチェーンリスク)
  - [インシデント対応計画](#インシデント対応計画)
  - [セキュリティテスト対応表](#セキュリティテスト対応表)
  - [受け入れ基準 (DoD)](#受け入れ基準-dod)

## 脅威モデリング方針
- STRIDE + LINDDUN (プライバシー) を補助的に使用。
- 四半期に一度、WG 全体で見直し。結果は[docs/notes/decision-log.md](../notes/decision-log.md)に記録。
- C/C++ 依存に起因するメモリ破壊リスクは設計段階で排除。

## STRIDE マトリクス
| STRIDE | 脅威例 | 影響 | 対策 |
|--------|--------|------|------|
| Spoofing | 偽 Beacon | 不正デバイス接続 | Beacon署名、公開鍵ピン留め |
| Tampering | パケット改ざん | データ破損 | AEAD (ChaCha20-Poly1305), 整合性チェック |
| Repudiation | 操作否認 | 監査不備 | 不変監査ログ + 署名 |
| Information Disclosure | セッション鍵漏洩 | 機密性低下 | HKDF再生成、最小権限アクセス |
| Denial of Service | FEC過負荷 | 可用性低下 | Rate limit, QoS優先度制御 |
| Elevation of Privilege | RBAC設定ミス | 権限逸脱 | 二重承認、ポリシー検証、テスト |

## 入力検証と出力エスケープ
- **入力:** JSON Schema バリデーション。サーバサイドで長さ・形式・範囲チェック。
- **出力:** HTML/Markdown はコンテキスト別エスケープ。ログ出力は構造化 JSON。
- **ハッシュ:** FNV-1a or BLAKE3 (純実装) を使用し、C/C++実装は禁止。

## CSRF/XSS/SQLi 対策
- **CSRF:** OAuth2 PKCE + SameSite=Lax クッキー。APIは Bearer トークン＋PoP 必須。
- **XSS:** CSP (Content-Security-Policy) strict-dynamic、DOMPurify 等の純言語実装でサニタイズ。
- **SQLi:** パラメータ化クエリ + ORM。ストアドプロシージャは使用しない。

## サプライチェーンリスク
- SBOM を全依存に対して作成。アップストリーム CVE を毎週スキャン。
- 依存の署名検証 (Sigstore 等)。C/C++ 依存パッケージは選定禁止。
- 開発者マシンはハードウェアセキュリティキー + 強制更新。

## インシデント対応計画
1. **検知:** Telemetry から異常アラート。SLA: 5 分以内にトリアージ開始。
2. **封じ込め:** トークン失効、影響範囲のセグメント化。
3. **根絶:** 影響コンポーネントのロールバック ([docs/deployment/rollback.md](../deployment/rollback.md))。
4. **復旧:** 新鍵発行、モニタリング強化。
5. **事後分析:** 72 時間以内にレポート。根本原因を[docs/notes/decision-log.md](../notes/decision-log.md)へ記載。

## セキュリティテスト対応表
| テスト | 頻度 | 対応する脅威 | 担当 |
|--------|------|--------------|------|
| 静的解析 (SAST) | 各コミット | Tampering, Information Disclosure | セキュリティWG |
| 動的解析 (DAST) | 月次 | XSS, CSRF, DoS | QA/SecOps |
| フィッシング演習 | 半期 | Spoofing | セキュリティWG |
| Red/Blue Team | 年次 | 全STRIDEカテゴリ | セキュリティ委員会 |
| サプライチェーン監査 | 四半期 | Elevation, Tampering | ガバナンス部門 |

## 受け入れ基準 (DoD)
- STRIDE マトリクスが全カテゴリをカバーし、対策が具体的に記述されている。
- 入力/出力対策、CSRF/XSS/SQLi 防御が定量的にまとめられている。
- サプライチェーン・インシデント対応・テストプランが相互参照されている。
- C/C++ 起因リスク排除が明記されている。
- 本文がロードマップ、テスト、デプロイ文書とリンクしている。
