# docs/testing/metrics.md

**バッジ:** `🚫 実装コード非出力` `🚫 C/C++依存禁止`

> HoneyLink™ 品質保証プログラムのメトリクスとゲートを定義します。テスト成果の可視化方法を示し、実装コードや C/C++ 依存は含めません。

## 目次
- [指標ガバナンス方針](#指標ガバナンス方針)
- [コア品質指標](#コア品質指標)
- [テストレイヤー別メトリクス](#テストレイヤー別メトリクス)
- [アラート閾値とエスカレーション](#アラート閾値とエスカレーション)
- [可視化とレポート](#可視化とレポート)
- [メトリクスレビューサイクル](#メトリクスレビューサイクル)
- [受け入れ基準 (DoD)](#受け入れ基準-dod)

## 指標ガバナンス方針
- メトリクスの定義・変更は QA リード + SRE + プロダクトマネージャでレビュー。
- 指標は SLI/SLO フレームワークに従い、[docs/requirements.md](../requirements.md) の非機能要件と整合。
- データソースは CI/CD, Observability, チケット管理。C/C++ 製エージェントは使用禁止。
- すべての指標は監査可能な形で [docs/notes/decision-log.md](../notes/decision-log.md) に記録。

## コア品質指標
| カテゴリ | 指標 | 定義 | 目標 |
|----------|------|------|------|
| 信頼性 | デプロイ成功率 | 正常リリース / 総リリース | ≥ 99% |
| 回帰防止 | 自動テスト検出率 | QA で検出 / 総欠陥 | ≥ 70% |
| 速度 | リードタイム | PR マージ→本番リリース | ≤ 24h |
| 安定性 | 変更失敗率 | ロールバック / リリース | ≤ 3% |
| セキュリティ | 発見までの平均時間 | CVE 発見→修正開始 | ≤ 48h |

- DORA 指標は週間レポートで共有。

## テストレイヤー別メトリクス
| レイヤー | 主要メトリクス | 閾値 | 連携文書 |
|----------|----------------|------|----------|
| 単体 | カバレッジ, 実行時間, フレーク率 | 90% / 5 分 / 1% | [docs/testing/unit-tests.md](unit-tests.md) |
| 統合 | 成功率, 再試行回数, 平均遅延 | 98% / ≤1 / ≤30分 | [docs/testing/integration-tests.md](integration-tests.md) |
| E2E | ジャーニー完了率, SLA 達成率 | 95% / 99% | [docs/testing/e2e-tests.md](e2e-tests.md) |
| 性能 | P99 レイテンシ, スループット達成率 | 120ms / 95% | [docs/performance/benchmark.md](../performance/benchmark.md) |
| セキュリティ | 脆弱性修正 SLA, 認証テスト成功率 | 72h / 100% | [docs/security/vulnerability.md](../security/vulnerability.md) |

## アラート閾値とエスカレーション
- Yellow (注意): 閾値の 90% に到達 → Slack + レポート注記。
- Orange (要対応): 閾値超過 1 サイクル → Jira ブロッカード、対策タスク要作成。
- Red (ブロック): 閾値超過 2 サイクル → リリース停止、デプロイゲート閉鎖。
- エスカレーション: QA リード → SRE → エグゼクティブ。最大 24h 以内に会議召集。

## 可視化とレポート
- ダッシュボード: Looker/PowerBI。データは Rust サービスで ETL、C/C++ ツールは使用しない。
- 更新頻度: 単体・統合=各コミット, E2E=週次, 性能=四半期。
- レポート構成: KPI, 傾向分析, アクションアイテム, リスク評価。
- 異常値検知: Z-score + Etsy の Seasonal Hybrid ESD アルゴリズム。

## メトリクスレビューサイクル
1. 週次: QA レビュー (実績 vs 目標)。
2. 月次: SRE/プロダクト合同レビュー。改善策を [docs/roadmap.md](../roadmap.md) に反映。
3. 四半期: エグゼクティブレビュー。SLO/ZBB (Zero Bug Bounce) の見直し。
4. 変更点は決定ログに記録し、関係者へ周知。

## 受け入れ基準 (DoD)
- 指標ガバナンスと責任範囲が定義されている。
- コア品質指標とレイヤー別メトリクスが表形式で整理されている。
- アラート閾値、可視化方法、レビューサイクルが明記されている。
- C/C++ 依存排除が明示され、関連文書とリンクしている。
- メトリクスが SLO/SLA 達成に直結している。