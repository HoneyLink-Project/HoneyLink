# Implementation Task Dependency Mapping & Critical Path Analysis

**バッジ:** `🚫 実装コード非出力` `🚫 C/C++依存禁止`

> `spec/roadmap.md` の依存関係マップを実装タスク (`TODO.md`) へマッピングし、プロジェクトのクリティカルパスを特定します。

---

## 目次
1. [概要](#1-概要)
2. [依存関係マッピング手法](#2-依存関係マッピング手法)
3. [モジュール依存と実装タスクの対応](#3-モジュール依存と実装タスクの対応)
4. [クリティカルパス分析](#4-クリティカルパス分析)
5. [リスク要因とバッファ設定](#5-リスク要因とバッファ設定)
6. [進捗追跡方法](#6-進捗追跡方法)
7. [変更履歴](#7-変更履歴)

---

## 1. 概要

### 1.1 目的
- `spec/architecture/dependencies.md` のモジュール依存グラフを実装タスクへ変換
- タスク間の依存関係を可視化し、並行作業可能な箇所を明確化
- プロジェクト全体のクリティカルパス（最長経路）を特定し、遅延リスクを管理

### 1.2 スコープ
- 対象フェーズ: P0 (完了済み) → P1 (仕様詳細化) → P2 (プロトタイプ設計)
- 対象タスク: `TODO.md` のセクション 0〜4 (環境整備、アーキテクチャ実装、API実装、UI基盤)
- クリティカルパス基準: タスク完了に最も時間がかかり、他タスクをブロックする経路

### 1.3 関連ドキュメント
- [spec/roadmap.md](../roadmap.md) - フェーズ概要と依存関係マップ
- [spec/architecture/dependencies.md](../architecture/dependencies.md) - モジュール依存グラフ
- [TODO.md](../../TODO.md) - 実装タスクリスト
- [spec/notes/phase-criteria.md](phase-criteria.md) - フェーズエントリ/エグジット基準

---

## 2. 依存関係マッピング手法

### 2.1 マッピングルール

1. **モジュール → タスクグループ変換**
   - `dependencies.md` の各モジュール（Session Orchestrator, Policy Engine等）を `TODO.md` のサブセクション（2.1, 2.2等）へマッピング

2. **依存の種類**
   - **ブロッキング依存 (B)**: タスクAが完了しないとタスクBを開始できない（例: Crypto実装 → Session Orchestrator実装）
   - **ソフト依存 (S)**: タスクAの完了が望ましいが、Bは並行開始可能（例: UI基盤 → SDK API実装）
   - **イベント依存 (E)**: 非同期イベントバス経由のため、スタブで開発可能（例: Telemetry → Session Orchestrator）

3. **クリティカルパス判定基準**
   - ブロッキング依存の連鎖が最も長い経路
   - 各タスクの推定工数（人日）を考慮
   - リソース競合（同一担当者の複数タスク）を考慮

### 2.2 タスク推定工数（参考値）

| タスク分類 | 推定工数 | 根拠 |
|-----------|---------|------|
| 環境構築 (1.1〜1.3) | 5人日 | ツールチェーン導入、リポジトリ構成、CI設定 |
| モジュール仕様書策定 (0.3) | 20人日 | 8モジュール × 2.5人日/モジュール |
| コアモジュール実装 (2.1〜2.5) | 60人日 | 各モジュール10〜15人日 |
| API実装 (3.1〜3.6) | 30人日 | エンドポイント × バリデーション × テスト |
| UI基盤 (4.1) | 15人日 | SPA構築 + デザインシステム統合 |

---

## 3. モジュール依存と実装タスクの対応

### 3.1 依存マトリクス

以下の表は `dependencies.md` のモジュール依存を `TODO.md` のタスクへマッピングしたものです。

| モジュール (依存元) | TODO タスク | 依存先モジュール | 依存先タスク | 依存種別 | 備考 |
|--------------------|------------|----------------|------------|---------|------|
| **Physical Adapter** | 2.3 (Transport Abstraction) | なし | なし | - | 最下層、他に依存なし |
| **Crypto & Trust** | 2.4 | なし | なし | - | 並行開発可能 |
| **Transport Abstraction** | 2.3 | Physical Adapter | 2.3 (アダプタAPI定義) | B | 物理層APIが先 |
| **QoS Scheduler** | 2.5 (Stream QoS Scheduler) | Transport Abstraction | 2.3 | B | WFQ実装にTransport層が必要 |
| **Policy Engine** | 2.2 | QoS Scheduler | 2.5 | S | ポリシー配信にQoS連携が必要だが、スタブで開発可 |
| **Session Orchestrator** | 2.1 | Policy Engine, Crypto & Trust | 2.2, 2.4 | B | 鍵合意とポリシー交渉が必須 |
| **Telemetry & Insights** | 2.5 (別タスク) | Session, QoS, Transport | 2.1, 2.5, 2.3 | E | イベント購読のみ、スタブ可 |
| **Control-Plane API** | 3.1〜3.6 | Session Orchestrator | 2.1 | B | セッション管理APIがコア |
| **Experience Layer** | 4.1 | Control-Plane API | 3.1〜3.6 | S | API仕様確定後に並行開発可 |

### 3.2 タスク依存グラフ (簡略版)

```
[1.1-1.3 環境整備] ────┬──> [0.3 モジュール仕様書]
                      │
                      └──> [2.4 Crypto] ──┐
                                          │
[2.3 Physical Adapter API定義] ──> [2.3 Transport] ──> [2.5 QoS] ──> [2.2 Policy]
                                                                         │
                                                                         v
                                          [2.1 Session Orchestrator] <──┘
                                                   │
                                                   v
                                          [3.1-3.6 Control-Plane API]
                                                   │
                                                   ├──> [4.1 UI基盤]
                                                   │
                                                   └──> [2.5 Telemetry] (並行)
```

---

## 4. クリティカルパス分析

### 4.1 クリティカルパス特定

以下の経路が **最長所要時間** となり、プロジェクト全体のクリティカルパスを構成します。

```
Path-CP1 (Critical Path 1):
[1.1-1.3 環境整備] (5日)
  ↓
[0.3 モジュール仕様書: Transport/QoS/Policy/Session] (12日)
  ↓
[2.3 Transport Abstraction] (15日)
  ↓
[2.5 Stream QoS Scheduler] (12日)
  ↓
[2.2 Policy Engine] (10日)
  ↓
[2.1 Session Orchestrator] (15日)
  ↓
[3.1-3.3 API実装: デバイス/セッション管理] (18日)
  ↓
[テスト・統合] (10日)
```

**合計所要時間: 97人日** (単一リソースでの直列作業時)

### 4.2 並行作業による短縮

以下のタスクは **並行実行可能** なため、実際のカレンダー日数を短縮できます。

| 並行グループ | タスク | 推定工数 | 前提条件 |
|-------------|--------|---------|---------|
| **グループA** | 2.4 Crypto & Trust | 10日 | 環境整備完了後すぐ開始可 |
| **グループB** | 4.1 UI基盤 | 15日 | API仕様確定後、実装完了を待たず開始可 |
| **グループC** | 2.5 Telemetry & Insights | 8日 | Session Orchestratorのイベント定義完了後 |

**並行作業時の短縮見込み:**
- Crypto (10日) を Session Orchestratorと並行 → **10日短縮**
- UI基盤 (15日) を API実装と並行 → **15日短縮**
- Telemetry (8日) を統合テストと並行 → **5日短縮**

**最適化後の所要時間: 67日** (3〜4名の並行作業を想定)

### 4.3 ボトルネックタスク

以下のタスクは **複数の後続タスクをブロック** するため、特に注意が必要です。

| タスク | ブロックする後続タスク数 | 遅延時のインパクト |
|--------|------------------------|------------------|
| **2.1 Session Orchestrator** | 5 (API実装全般) | **Critical** - API実装全体が停止 |
| **2.3 Transport Abstraction** | 3 (QoS, Policy, Telemetry) | **High** - 中核機能が進まない |
| **3.1-3.2 デバイス/セッションAPI** | 2 (UI, SDK実装) | **Medium** - フロントエンド開発が停止 |

**リスク緩和策:**
- Session Orchestratorはシニアエンジニアを優先アサイン
- Transport Abstractionは週次進捗確認を実施
- API実装はスタブを先行作成し、UI開発をブロックしない

---

## 5. リスク要因とバッファ設定

### 5.1 遅延リスク要因

| リスク要因 | 影響度 | 確率 | 緩和策 | バッファ設定 |
|-----------|-------|------|--------|------------|
| Crypto実装の技術的難易度 | High | 30% | RustCrypto専門家レビュー | +3日 |
| Transport層のFEC統合 | Medium | 40% | Reed-Solomon実装の事前PoC | +5日 |
| API仕様変更による手戻り | Medium | 50% | 仕様フリーズを2.1完了時点で実施 | +7日 |
| UI基盤のデザインシステム統合 | Low | 20% | デザイントークン事前定義 | +2日 |
| リソース競合 (担当者病欠等) | High | 20% | バックアップ担当者を事前指名 | +5日 |

**合計バッファ: 22日** (最適化後所要時間の約33%)

**目標スケジュール:**
- クリティカルパス: 67日 (並行作業時)
- バッファ込み: **89日 (約3ヶ月)**
- 開始日: 2025年10月1日
- **目標完了日: 2025年12月29日**

### 5.2 早期警戒トリガー

以下の兆候が出た場合、直ちにエスカレーションします。

| 兆候 | トリガー基準 | アクション |
|------|------------|-----------|
| ボトルネックタスクの遅延 | 計画より3日以上遅延 | リソース追加投入、スコープ縮小検討 |
| ブロッキング依存の未解決 | 依存先タスクが予定開始日の3日前に未完了 | 依存先の優先度を最高へ変更 |
| バッファ消費率50%超 | プロジェクト進捗50%時点でバッファ11日以上消費 | ガバナンス委員会へエスカレーション、代替案検討 |

---

## 6. 進捗追跡方法

### 6.1 進捗測定指標

- **タスク完了率**: (完了タスク数 / 全タスク数) × 100
- **クリティカルパス進捗率**: クリティカルパス上の完了タスク工数 / 全体工数
- **バッファ消費率**: (実績遅延日数 / 設定バッファ日数) × 100
- **並行度**: 同時進行中のタスク数 (最適: 3〜4タスク)

### 6.2 ダッシュボード設定

**ツール**: GitHub Projects (カンバンボード) + Google Sheets (ガントチャート)

**ダッシュボード項目**:
1. **ガントチャート**
   - タスクバーをクリティカルパス (赤色) と並行タスク (青色) で色分け
   - 依存関係を矢印で可視化
   - 現在日のマーカー表示

2. **進捗サマリー**
   - 全体進捗率 (%)
   - クリティカルパス進捗率 (%)
   - バッファ残日数
   - 遅延タスク一覧

3. **リスクヒートマップ**
   - 縦軸: 影響度 (Critical/High/Medium/Low)
   - 横軸: 発生確率 (%)
   - 各リスクをプロット

### 6.3 更新頻度

- **日次**: タスク完了時に GitHub Projects で `Done` へ移動
- **週次**: Operations WG が進捗率を計算し、ダッシュボードを更新
- **月次**: ガバナンス委員会レビューで目標達成見込みを評価

### 6.4 ダッシュボードURL (プレースホルダー)

- **GitHub Projects**: `https://github.com/<org>/HoneyLink/projects/1`
- **Google Sheets ガントチャート**: `https://docs.google.com/spreadsheets/d/<id>`
- **リスクヒートマップ**: `spec/notes/risk-heatmap.md` (月次更新)

---

## 7. アクションアイテム

以下のタスクを実行し、クリティカルパス管理を確立します。

- [ ] **タスク推定工数の精緻化**: 各モジュール担当者が詳細見積もりを提出 (期限: 2025-10-05)
- [ ] **GitHub Projects セットアップ**: Operations WG がカンバンボード作成 (期限: 2025-10-08)
- [ ] **ガントチャート作成**: Section 6.2 の仕様に従い Google Sheets で作成 (期限: 2025-10-10)
- [ ] **担当者アサイン**: 各タスクに担当者 (Role ID) を割当 (期限: 2025-10-12)
- [ ] **バックアップ担当者指名**: ボトルネックタスクにバックアップ担当を設定 (期限: 2025-10-12)
- [ ] **週次進捗レビュー日程**: Operations WG が毎週金曜10:00に進捗確認ミーティング設定 (期限: 2025-10-08)
- [ ] **早期警戒アラート設定**: バッファ消費率50%到達時に Slack `#hl-ops-wg` へ自動通知 (期限: 2025-10-15)

---

## 8. 変更履歴

| バージョン | 日付 | 変更内容 | 承認者 |
|-----------|------|---------|--------|
| 1.0 | 2025-10-01 | 初版作成 (クリティカルパス分析とバッファ設定) | Governance Council |

---

**付録: クリティカルパス詳細 (CSV)**

以下のCSVデータを `spec/notes/critical-path.csv` として保存し、プロジェクト管理ツールへインポート可能です。

```csv
TaskID,TaskName,Duration(days),Dependencies,IsCritical,Owner
T1.1,環境整備,5,,TRUE,OPS-LEAD-02
T0.3,モジュール仕様書策定,12,T1.1,TRUE,ENG-ARCH-01
T2.3,Transport Abstraction,15,T0.3,TRUE,ENG-PROTO-02
T2.5,Stream QoS Scheduler,12,T2.3,TRUE,ENG-PROTO-03
T2.2,Policy Engine,10,T2.5,TRUE,ENG-PROTO-01
T2.1,Session Orchestrator,15,T2.2;T2.4,TRUE,ENG-ARCH-02
T3.1,デバイス管理API,8,T2.1,TRUE,ENG-PROTO-04
T3.2,セッション管理API,10,T2.1,TRUE,ENG-PROTO-04
T2.4,Crypto & Trust,10,T1.1,FALSE,SEC-ARCH-02
T4.1,UI基盤,15,T3.1,FALSE,UX-LEAD-01
T2.6,Telemetry & Insights,8,T2.1,FALSE,OPS-LEAD-02
```

---

**関連ドキュメント**:
- [spec/roadmap.md](../roadmap.md) - フェーズ依存関係マップ
- [spec/architecture/dependencies.md](../architecture/dependencies.md) - モジュール依存グラフ
- [TODO.md](../../TODO.md) - 実装タスクリスト
- [spec/notes/phase-criteria.md](phase-criteria.md) - エントリ/エグジット基準
- [spec/testing/metrics.md](../testing/metrics.md) - スケジュール遵守率の測定方法

